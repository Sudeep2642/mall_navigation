<!DOCTYPE html>
<html>
<head>
    <title>Mall Indoor Navigation</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
<body>

<h1>üè¨ Mall Indoor Navigation Demo</h1>

<div class="container">

    <h3>Scan QR to Set Current Location</h3>
    <div id="reader" style="width:300px;margin:auto;"></div>
    <p id="scan-result">Scanned Location: None</p>

    <h3>Select Destination</h3>
    <select id="destination">
        {% for location in locations %}
        <option value="{{ location }}">{{ location }}</option>
        {% endfor %}
    </select>

    <button onclick="findPath()">Navigate</button>

    <h3>Route:</h3>
    <p id="route"></p>

</div>

<!-- <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>

<script>
let currentLocation = "";

let scanner = new Instascan.Scanner({ video: document.getElementById('preview') });

scanner.addListener('scan', function (content) {
    currentLocation = content;
    document.getElementById("scan-result").innerText = "Scanned Location: " + content;
});

Instascan.Camera.getCameras().then(function (cameras) {
    if (cameras.length > 0) {
        scanner.start(cameras[0]);
    }
});

function findPath() {
    let destination = document.getElementById("destination").value;

    fetch("/navigate", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            start: currentLocation,
            end: destination
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.path) {
            document.getElementById("route").innerText = data.path.join(" ‚ûú ");
        } else {
            document.getElementById("route").innerText = "Error: " + data.error;
        }
    });
}
</script> -->

<script>
let currentLocation = "";

function onScanSuccess(decodedText) {
    currentLocation = decodedText;
    document.getElementById("scan-result").innerText =
        "Scanned Location: " + decodedText;
}

let html5QrcodeScanner = new Html5QrcodeScanner(
    "reader",
    { fps: 10, qrbox: 250 }
);

html5QrcodeScanner.render(onScanSuccess);

function findPath() {
    let destination = document.getElementById("destination").value;

    if (!currentLocation) {
        alert("Please scan QR first!");
        return;
    }

    fetch("/navigate", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            start: currentLocation,
            end: destination
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.path) {
            document.getElementById("route").innerText =
                data.path.join(" ‚ûú ");
        } else {
            document.getElementById("route").innerText =
                "Error: " + data.error;
        }
    });
}
</script>


</body>
</html>
